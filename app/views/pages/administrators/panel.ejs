<!Doctype html>
<html>
    <head>
        <% include ../../partials/head %>
    </head>
    <body>
        <div class='container text-center mt-2 mb-2'>
            <input type='text' placeholder='Search'>
            <form id='sign-out' action="/administrators/signout" method="GET" style='display: inline;'>
                <input type="submit" name="signout" value="Sign Out" />
            </form>
        </div>
        <table id='administrative-panel' class='table'>
            <thead>
                <tr>
                    <th scope='col'>#</th>
                    <th scope='col'>Name</th>
                    <th scope='col'>Email</th>
                    <th scope='col'>Instagram</th>
                    <th scope='col'>Status</th>
                </tr>
            </thead>
        </table>

        <footer>
            <% include ../../partials/footer %>
        </footer>
    </body>

    <script>
        var ind = 1;
        $.ajax({
            method: 'GET', 
            url: '/administrators/profiles',
            success: (profiles) => {
                $.ajax({
                    method: 'GET',
                    url: '/administrators/rights',
                    success: (rights) => {
                        profiles.forEach((profile, index) => {
                            for (var i = 0; i < rights.length; i++) {
                                var possibleRights = ['0', '1']
                                if (profile.email === rights[i].email && possibleRights.includes(rights[i].rights)) {
                                    var row = $(`
                                        <tr>
                                            <th scope='col'>${ind}</th>
                                            <td>${profile.first_name}</td>
                                            <td>${profile.email}</td>
                                            <td>${profile.instagram_handle}</td>
                                            <td>${(rights[i].rights == 0) ? 'Unverified Influnecer' : 'Verified Influencer'}</td>
                                        </tr>
                                    `);
                                    $('#administrative-panel tr:last').after(row);
                                    ind++;
                                    break;
                                }
                            }
                        }); 
                    }
                });
            }
        });
    </script>
</html>