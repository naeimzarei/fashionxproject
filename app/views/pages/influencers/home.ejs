<!DOCTYPE html>
<html>
  <head>
    <% include ../../partials/head %>
  </head>
  <body>
      <header>
        <% include ../../partials/header %>
      </header>
      <section id = "homeSection">
        <% include ../../partials/nav %>
    <main>
        <div class="container-fluid">
          <%if (posts.length === 0) { %>
            <h3 class="text-center">No posts created yet.</h3>
          <% } else { %>
            <table class="table table-borderless">
              <thead>
                <tr>
                  <th scope="col">Pictures</th>
                  <th scope="col">Item</th>
                  <th scope = "col">Description</th>
                  <th scope="col">Price</th>
                  <th scope="col">Status</th>
                  <th scope="col">Actions</th>
                </tr>
              </thead>
              <tbody>


<% if (posts && posts.filter(post => post.status === 'New').length >= 5) { %> 
     <button class="btn btn-pink btn-primary text-center" data-toggle="modal" data-target="#addWeightModal" id = "pre-shipping"> Send me pre-shipping label</button>
<% } else { %> 
     <button class="btn btn-pink btn-primary text-center" data-toggle="modal" data-target="#addWeightModal" id = "pre-shipping" disabled>Send me pre-shipping label</button>
<% } %>

<!-- Add Weight Modal -->
<div class="modal fade" id="addWeightModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                        <form action='/influencers/preshippingLabel' method='post' class="form-horizontal" role="form">
                                <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLongTitle">Submit pre-shipping label request</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                        </button>
                                </div>
                                <div class="modal-body">
                                        Box Weight
                                        <input class='form-control border-pink col-md-3 mr-md-2 mt-2' id="inputWeight" name='box_weight' type='number' placeholder='Pounds'>
                                </div>
                                <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                        <!-- <button type="submit" id="sendPreshippingLabel" class="btn btn-primary" data-dismiss="modal" data-toggle="modal" data-target="#approvedModal">Submit request</button> -->
                                        <button id="sendPreshippingLabel" type="submit">Submit request</button>
                                </div>
                        </form>
                </div>
        </div>
</div>
<!-- Approved Modal -->
<div class="modal fade" id="approvedModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Thank you!</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p id = "approvalMessage">
         We have successfully been notified about your request for a pre-shipping label.
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Thanks!</button>
      </div>
    </div>
  </div>
</div>




                <!-- -->
                  <% posts.forEach(function(post) { %>
                    <tr>
                      <td><img src="<%= post.img_urls[0] %>" alt="<%= post.title %> Thumbnail" class="img-thumbnail" style="max-width: 200px;"></td>
                      <td scope="row"><%= post.item %></td>
                      <td scope="row" style="max-width: 200px;"><%= post.description %></td>
                      <td>$<%= post.selling_price %></td>
                      <td><%= post.status %></td>
                      <td>
                        <form action="/influencers/posts/<%= post.id %>/delete" method="post">
                          <a href="/influencers/posts/<%= post.id %>"><button type="button" class="btn btn-info btn-sm">View</button></a>
                          <a href="/influencers/posts/<%= post.id %>/edit"><button type="button" class="btn btn-secondary btn-sm">Edit</button></a>
                          <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this post?');">Delete</button>
                        </form>
                      </td>
                    </tr>
                  <% }); %>
              </tbody>
            </table>
          <% } %>
        </div>
    </main>
      </section>
      
    <footer>
      <% include ../../partials/footer %>
    </footer>
    <script>
      $('#sendPreshippingLabel').click(function(event){
                    var temp = document.getElementById('inputWeight').value
                  if(isNaN(parseInt(temp)) ||  parseInt(temp) <= 0){
                    event.preventDefault();
                  $('#approvalMessage').text("Invalid Weight. Try again.");
                  }else{
                      $('#approvalMessage').text("We have successfully been notified about your request for a pre-shipping label.");
                  }
          })
          </script>
  </body>
</html>
